# https://github.com/dependabot/dependabot-core/issues/1736
name: Dependabot - Recreate Pull Requests
on:
  push:
    branches:
      - main
  workflow_dispatch:
permissions: read-all
jobs:
  add-comment-recreate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: tibdex/github-app-token@f717b5ecd4534d3c4df4ce9b5c1c2214f0f7cd06 # v1.5 # cspell:ignore tibdex
        id: generate-token
        with:
          app_id: ${{ secrets.AUTOMATION_APP_ID }}
          private_key: ${{ secrets.AUTOMATION_PRIVATE_KEY }}

      - name: Show Open PRs
        env:
          GH_TOKEN: ${{ steps.generate-token.outputs.token }}
        run: |
          gh pr list -S "-label:cspell5 author:app/dependabot"

      - name: Get Open PRs and apply comment
        env:
          GH_TOKEN: ${{ steps.generate-token.outputs.token }}
        run: >
          gh pr list -S "-label:cspell5 author:app/dependabot" --json number
          | jq '.[].number'
          | xargs -n1 gh pr comment -b "@dependabot recreate"
